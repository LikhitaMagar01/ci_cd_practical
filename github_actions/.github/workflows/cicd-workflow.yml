name: CICD

on:
    push: 
        branches: [ci/cd-docker-ec2]
    
jobs:
    build:
        runs-on: [ubuntu-latest]
        steps:
           - name: Checkout source
             uses: actions/checkout@v3
           - name: Login to docker hub
             run: docker login -u ${{ secretS.DOCKER_USERNAME }} -p ${{ secrets.DOCKER_PASSWORD }}
           - name: Build docker image
             run: docker build -t integrationCICD/Ratatoullie-bento .
           - name: Publish image to docker hub
             run: docker push integrationCICD/Ratatoullie-bento:latest

    deploy:
        needs: build
        runs-on: [aws-ec2]
        steps:
          - name: Pull image from docker hub
            run: docker pull integrationCICD/Ratatoullie-bento:latest
          - name: Delte old container
            run: docker rm -f Ratatoullie-bento-container
          - name: RUn docker container
            run: docker run -d -p 3000:3000 -name Ratatoullie-bento-container integrationCICD/Ratatoullie-bento
